# Analytics-Vidhya-Hackart-Hack
Data Hackathon by Analytics Vidhya - "Hackart"
libname mckinsey "\\VBOXSVR\Shared_folder_with_XP_for_SAS\Mckinsey datahack";                                                                                                                                                                                   
proc import datafile="\\VBOXSVR\Shared_folder_with_XP_for_SAS\Mckinsey datahack\Train_psolI3n.csv"                                                                                                                                                              
dbms=csv out=mckinsey.multilogit replace;                                                                                                                                                                                                                       
getnames=yes;                                                                                                                                                                                                                                                   
run;                                                                                                                                        

proc contents data=mckinsey.multilogit varnum;                                                                                                                                                                                                                  
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
/*---------------------------exporting proc means output to set the limits for outlier and checking the distribution of data--------------------------*/                                                                                                        
ods html file="\\VBOXSVR\Shared_folder_with_XP_for_SAS\Mckinsey datahack\multilogit.xls";                                                                                                                                                                       
proc means data=mckinsey.multilogit N Nmiss mean std min P1 P5 P10 P90 P95 P99 max ;                                                                                                                                                                            
run;                                                                                                                                                                                                                                                            
ods html close;                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
data multilogit;                                                                                                                                                                                                                                                
set mckinsey.multilogit;                                                                                                                                                                                                                                        
if Total_Links > 30 then Total_Links = 30;                                                                                                                                                                                                                      
if Total_Images > 20 then Total_Images = 20;                                                                                                                                                                                                                    
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
data multilogit;                                                                                                                                                                                                                                                
set multilogit;                                                                                                                                                                                                                                                 
If Customer_Location = "A" then Customer_Location_new = 1 ;                                                                                                                                                                                                     
If Customer_Location = "B" then Customer_Location_new = 2 ;                                                                                                                                                                                                     
If Customer_Location = "C" then Customer_Location_new = 3 ;                                                                                                                                                                                                     
If Customer_Location = "D" then Customer_Location_new = 4 ;                                                                                                                                                                                                     
If Customer_Location = "E" then Customer_Location_new = 5 ;                                                                                                                                                                                                     
If Customer_Location = "F" then Customer_Location_new = 6 ;                                                                                                                                                                                                     
If Customer_Location = "G" then Customer_Location_new = 7 ;                                                                                                                                                                                                     
If Customer_Location = "" then Customer_Location_new = 9 ; /*na considered as other=9*/                                                                                                                                                                         
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
proc means data=multilogit N Nmiss mean std min P1 P5 P10 P90 P95 P99 max ;                                                                                                                                                                                     
where Customer_Location_new = 1;                                                                                                                                                                                                                                
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
proc means data=multilogit N Nmiss mean std min P1 P5 P10 P90 P95 P99 max ;                                                                                                                                                                                     
where Customer_Location_new = 2;                                                                                                                                                                                                                                
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
proc means data=multilogit N Nmiss mean std min P1 P5 P10 P90 P95 P99 max ;                                                                                                                                                                                     
where Customer_Location_new = 3;                                                                                                                                                                                                                                
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
proc means data=multilogit N Nmiss mean std min P1 P5 P10 P90 P95 P99 max ;                                                                                                                                                                                     
where Customer_Location_new = 4;                                                                                                                                                                                                                                
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
proc means data=multilogit N Nmiss mean std min P1 P5 P10 P90 P95 P99 max ;                                                                                                                                                                                     
where Customer_Location_new = 5;                                                                                                                                                                                                                                
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
proc means data=multilogit N Nmiss mean std min P1 P5 P10 P90 P95 P99 max ;                                                                                                                                                                                     
where Customer_Location_new = 6;                                                                                                                                                                                                                                
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
proc means data=multilogit N Nmiss mean std min P1 P5 P10 P90 P95 P99 max ;                                                                                                                                                                                     
where Customer_Location_new = 7;                                                                                                                                                                                                                                
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
proc means data=multilogit N Nmiss mean std min P1 P5 P10 P90 P95 P99 max ;                                                                                                                                                                                     
where Customer_Location_new = 9;                                                                                                                                                                                                                                
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
data multilogit;                                                                                                                                                                                                                                                
set multilogit;                                                                                                                                                                                                                                                 
If ((Customer_Location_new = 1) & (Total_Past_Communications = .)) then Total_Past_Communications = 29  ;                                                                                                                                                       
If ((Customer_Location_new = 2) & (Total_Past_Communications = .)) then Total_Past_Communications =29   ;                                                                                                                                                       
If ((Customer_Location_new = 3) & (Total_Past_Communications = .)) then Total_Past_Communications =29   ;                                                                                                                                                       
If ((Customer_Location_new = 4) & (Total_Past_Communications = .)) then Total_Past_Communications = 29  ;                                                                                                                                                       
If ((Customer_Location_new = 5) & (Total_Past_Communications = .)) then Total_Past_Communications = 29  ;                                                                                                                                                       
If ((Customer_Location_new = 6) & (Total_Past_Communications = .)) then Total_Past_Communications = 29  ;                                                                                                                                                       
If ((Customer_Location_new = 7) & (Total_Past_Communications = .)) then Total_Past_Communications = 29  ;                                                                                                                                                       
If ((Customer_Location_new = 9) & (Total_Past_Communications = .)) then Total_Past_Communications = 29  ;                                                                                                                                                       
If ((Customer_Location_new = 1) & (Total_Links = .)) then Total_Links = 10  ;                                                                                                                                                                                   
If ((Customer_Location_new = 2) & (Total_Links = .)) then Total_Links = 10  ;                                                                                                                                                                                   
If ((Customer_Location_new = 3) & (Total_Links = .)) then Total_Links = 10  ;                                                                                                                                                                                   
If ((Customer_Location_new = 4) & (Total_Links = .)) then Total_Links = 10  ;                                                                                                                                                                                   
If ((Customer_Location_new = 5) & (Total_Links = .)) then Total_Links = 10  ;                                                                                                                                                                                   
If ((Customer_Location_new = 6) & (Total_Links = .)) then Total_Links = 11  ;                                                                                                                                                                                   
If ((Customer_Location_new = 7) & (Total_Links = .)) then Total_Links = 10  ;                                                                                                                                                                                   
If ((Customer_Location_new = 9) & (Total_Links = .)) then Total_Links = 10  ;                                                                                                                                                                                   
If ((Customer_Location_new = 1) & (Total_Images = .)) then Total_Images = 4  ;                                                                                                                                                                                  
If ((Customer_Location_new = 2) & (Total_Images = .)) then Total_Images = 3  ;                                                                                                                                                                                  
If ((Customer_Location_new = 3) & (Total_Images = .)) then Total_Images = 4  ;                                                                                                                                                                                  
If ((Customer_Location_new = 4) & (Total_Images = .)) then Total_Images = 3 ;                                                                                                                                                                                   
If ((Customer_Location_new = 5) & (Total_Images = .)) then Total_Images = 3  ;                                                                                                                                                                                  
If ((Customer_Location_new = 6) & (Total_Images = .)) then Total_Images = 4  ;                                                                                                                                                                                  
If ((Customer_Location_new = 7) & (Total_Images = .)) then Total_Images = 3  ;                                                                                                                                                                                  
If ((Customer_Location_new = 9) & (Total_Images = .)) then Total_Images = 3  ;                                                                                                                                                                                  
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
proc means data=multilogit N Nmiss mean std min P1 P5 P10 P90 P95 P99 max ;                                                                                                                                                                                     
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
data multilogit;                                                                                                                                                                                                                                                
set multilogit;                                                                                                                                                                                                                                                 
where Email_Type ne .;                                                                                                                                                                                                                                          
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
data multilogit;                                                                                                                                                                                                                                                
set multilogit;                                                                                                                                                                                                                                                 
if Email_Type = 1 then Email_Type_new = 0; else Email_Type_new = 1;                                                                                                                                                                                             
if Email_Source_Type = 1 then Email_Source_Type_new = 0; else Email_Source_Type_new = 1;                                                                                                                                                                        
if Customer_Location_new = 1 then Customer_Location_new_1 = 1; else Customer_Location_new_1 = 0;                                                                                                                                                                
if Customer_Location_new = 2 then Customer_Location_new_2 = 1; else Customer_Location_new_2 = 0;                                                                                                                                                                
if Customer_Location_new = 3 then Customer_Location_new_3 = 1; else Customer_Location_new_3 = 0;                                                                                                                                                                
if Customer_Location_new = 4 then Customer_Location_new_4 = 1; else Customer_Location_new_4 = 0;                                                                                                                                                                
if Customer_Location_new = 5 then Customer_Location_new_5 = 1; else Customer_Location_new_5 = 0;                                                                                                                                                                
if Customer_Location_new = 6 then Customer_Location_new_6 = 1; else Customer_Location_new_6 = 0;                                                                                                                                                                
if Customer_Location_new = 7 then Customer_Location_new_7 = 1; else Customer_Location_new_7 = 0;                                                                                                                                                                
if Email_Campaign_Type = 1 then Email_Campaign_Type_1 = 1; else Email_Campaign_Type_1 = 0;                                                                                                                                                                      
if Email_Campaign_Type = 2 then Email_Campaign_Type_2 = 1; else Email_Campaign_Type_2 = 0;                                                                                                                                                                      
if Time_Email_sent_Category = 1 then Time_Email_sent_Category_1 = 1; else Time_Email_sent_Category_1 = 0;                                                                                                                                                       
if Time_Email_sent_Category = 2 then Time_Email_sent_Category_2 = 1; else Time_Email_sent_Category_2 = 0;                                                                                                                                                       
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
data multilogit;                                                                                                                                                                                                                                                
set multilogit;                                                                                                                                                                                                                                                 
if Email_Status = 0 then Email_Status_0 = 1; else Email_Status_0 = 0;                                                                                                                                                                                           
if Email_Status = 1 then Email_Status_1 = 1; else Email_Status_1 = 0;                                                                                                                                                                                           
if Email_Status = 2 then Email_Status_2 = 1; else Email_Status_2 = 0;                                                                                                                                                                                           
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
/*-----------------------------------------Dividing datasets into validation and development datasets---------------------------------------------*/                                                                                                            
data dev val;                                                                                                                                                                                                                                                   
set multilogit;                                                                                                                                                                                                                                                 
if ranuni(12345)<=0.7 then output dev;                                                                                                                                                                                                                          
else output val;                                                                                                                                                                                                                                                
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
proc contents data=dev varnum;                                                                                                                                                                                                                                  
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
proc means data=dev N Nmiss mean std min P1 P5 P10 P90 P95 P99 max ;                                                                                                                                                                                            
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
/**************************checking concordance for 3 datasets with dev and val both*************************************************************/                                                                                                              
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
proc logistic data = dev descending                                                                                                                                                                                                                             
outest=modeldev1;                                                                                                                                                                                                                                               
model Email_Status_0 =                                                                                                                                                                                                                                          
Email_Type_new                                                                                                                                                                                                                                                  
 Email_Source_Type_new                                                                                                                                                                                                                                          
 Customer_Location_new_1                                                                                                                                                                                                                                        
Customer_Location_new_2                                                                                                                                                                                                                                         
 Customer_Location_new_3                                                                                                                                                                                                                                        
 Customer_Location_new_4                                                                                                                                                                                                                                        
 Customer_Location_new_5                                                                                                                                                                                                                                        
Customer_Location_new_6                                                                                                                                                                                                                                         
Customer_Location_new_7                                                                                                                                                                                                                                         
Email_Campaign_Type_1                                                                                                                                                                                                                                           
Email_Campaign_Type_2                                                                                                                                                                                                                                           
Time_Email_sent_Category_1                                                                                                                                                                                                                                      
Time_Email_sent_Category_2                                                                                                                                                                                                                                      
Subject_Hotness_Score                                                                                                                                                                                                                                           
Total_Past_Communications                                                                                                                                                                                                                                       
Word_Count                                                                                                                                                                                                                                                      
Total_Links                                                                                                                                                                                                                                                     
Total_Images                                                                                                                                                                                                                                                    
/ selection=stepwise stb lackfit rsq cl;                                                                                                                                                                                                                        
output out =tmp1 p=newpred;                                                                                                                                                                                                                                     
run;                                                                                                                                                                                                                                                            
proc logistic data = dev descending                                                                                                                                                                                                                             
outest=modeldev2;                                                                                                                                                                                                                                               
model Email_Status_1 =                                                                                                                                                                                                                                          
Email_Type_new                                                                                                                                                                                                                                                  
 Email_Source_Type_new                                                                                                                                                                                                                                          
 Customer_Location_new_1                                                                                                                                                                                                                                        
Customer_Location_new_2                                                                                                                                                                                                                                         
 Customer_Location_new_3                                                                                                                                                                                                                                        
 Customer_Location_new_4                                                                                                                                                                                                                                        
 Customer_Location_new_5                                                                                                                                                                                                                                        
Customer_Location_new_6                                                                                                                                                                                                                                         
Customer_Location_new_7                                                                                                                                                                                                                                         
Email_Campaign_Type_1                                                                                                                                                                                                                                           
Email_Campaign_Type_2                                                                                                                                                                                                                                           
Time_Email_sent_Category_1                                                                                                                                                                                                                                      
Time_Email_sent_Category_2                                                                                                                                                                                                                                      
Subject_Hotness_Score                                                                                                                                                                                                                                           
Total_Past_Communications                                                                                                                                                                                                                                       
Word_Count                                                                                                                                                                                                                                                      
Total_Links                                                                                                                                                                                                                                                     
Total_Images                                                                                                                                                                                                                                                    
/ selection=stepwise stb lackfit rsq cl;                                                                                                                                                                                                                        
output out =tmp2 p=newpred;                                                                                                                                                                                                                                     
run;                                                                                                                                                                                                                                                            
proc logistic data = dev descending                                                                                                                                                                                                                             
outest=modeldev3;                                                                                                                                                                                                                                               
model Email_Status_2 =                                                                                                                                                                                                                                          
Email_Type_new                                                                                                                                                                                                                                                  
 Email_Source_Type_new                                                                                                                                                                                                                                          
 Customer_Location_new_1                                                                                                                                                                                                                                        
Customer_Location_new_2                                                                                                                                                                                                                                         
 Customer_Location_new_3                                                                                                                                                                                                                                        
 Customer_Location_new_4                                                                                                                                                                                                                                        
 Customer_Location_new_5                                                                                                                                                                                                                                        
Customer_Location_new_6                                                                                                                                                                                                                                         
Customer_Location_new_7                                                                                                                                                                                                                                         
Email_Campaign_Type_1                                                                                                                                                                                                                                           
Email_Campaign_Type_2                                                                                                                                                                                                                                           
Time_Email_sent_Category_1                                                                                                                                                                                                                                      
Time_Email_sent_Category_2                                                                                                                                                                                                                                      
Subject_Hotness_Score                                                                                                                                                                                                                                           
Total_Past_Communications                                                                                                                                                                                                                                       
Word_Count                                                                                                                                                                                                                                                      
Total_Links                                                                                                                                                                                                                                                     
Total_Images                                                                                                                                                                                                                                                    
/ selection=stepwise stb lackfit rsq cl;                                                                                                                                                                                                                        
output out =tmp3 p=newpred;                                                                                                                                                                                                                                     
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
proc logistic data = val descending                                                                                                                                                                                                                             
outest=modelval1;                                                                                                                                                                                                                                               
model Email_Status_0 =                                                                                                                                                                                                                                          
Email_Type_new                                                                                                                                                                                                                                                  
 Email_Source_Type_new                                                                                                                                                                                                                                          
 Customer_Location_new_1                                                                                                                                                                                                                                        
Customer_Location_new_2                                                                                                                                                                                                                                         
 Customer_Location_new_3                                                                                                                                                                                                                                        
 Customer_Location_new_4                                                                                                                                                                                                                                        
 Customer_Location_new_5                                                                                                                                                                                                                                        
Customer_Location_new_6                                                                                                                                                                                                                                         
Customer_Location_new_7                                                                                                                                                                                                                                         
Email_Campaign_Type_1                                                                                                                                                                                                                                           
Email_Campaign_Type_2                                                                                                                                                                                                                                           
Time_Email_sent_Category_1                                                                                                                                                                                                                                      
Time_Email_sent_Category_2                                                                                                                                                                                                                                      
Subject_Hotness_Score                                                                                                                                                                                                                                           
Total_Past_Communications                                                                                                                                                                                                                                       
Word_Count                                                                                                                                                                                                                                                      
Total_Links                                                                                                                                                                                                                                                     
Total_Images                                                                                                                                                                                                                                                    
/ selection=stepwise stb lackfit rsq cl;                                                                                                                                                                                                                        
output out =tmpval1 p=newpred;                                                                                                                                                                                                                                  
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
proc logistic data = val descending                                                                                                                                                                                                                             
outest=modelval2;                                                                                                                                                                                                                                               
model Email_Status_1 =                                                                                                                                                                                                                                          
Email_Type_new                                                                                                                                                                                                                                                  
 Email_Source_Type_new                                                                                                                                                                                                                                          
 Customer_Location_new_1                                                                                                                                                                                                                                        
Customer_Location_new_2                                                                                                                                                                                                                                         
 Customer_Location_new_3                                                                                                                                                                                                                                        
 Customer_Location_new_4                                                                                                                                                                                                                                        
 Customer_Location_new_5                                                                                                                                                                                                                                        
Customer_Location_new_6                                                                                                                                                                                                                                         
Customer_Location_new_7                                                                                                                                                                                                                                         
Email_Campaign_Type_1                                                                                                                                                                                                                                           
Email_Campaign_Type_2                                                                                                                                                                                                                                           
Time_Email_sent_Category_1                                                                                                                                                                                                                                      
Time_Email_sent_Category_2                                                                                                                                                                                                                                      
Subject_Hotness_Score                                                                                                                                                                                                                                           
Total_Past_Communications                                                                                                                                                                                                                                       
Word_Count                                                                                                                                                                                                                                                      
Total_Links                                                                                                                                                                                                                                                     
Total_Images                                                                                                                                                                                                                                                    
/ selection=stepwise stb lackfit rsq cl;                                                                                                                                                                                                                        
output out =tmpval2 p=newpred;                                                                                                                                                                                                                                  
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
proc logistic data = val descending                                                                                                                                                                                                                             
outest=modelval3;                                                                                                                                                                                                                                               
model Email_Status_2 =                                                                                                                                                                                                                                          
Email_Type_new                                                                                                                                                                                                                                                  
 Email_Source_Type_new                                                                                                                                                                                                                                          
 Customer_Location_new_1                                                                                                                                                                                                                                        
Customer_Location_new_2                                                                                                                                                                                                                                         
 Customer_Location_new_3                                                                                                                                                                                                                                        
 Customer_Location_new_4                                                                                                                                                                                                                                        
 Customer_Location_new_5                                                                                                                                                                                                                                        
Customer_Location_new_6                                                                                                                                                                                                                                         
Customer_Location_new_7                                                                                                                                                                                                                                         
Email_Campaign_Type_1                                                                                                                                                                                                                                           
Email_Campaign_Type_2                                                                                                                                                                                                                                           
Time_Email_sent_Category_1                                                                                                                                                                                                                                      
Time_Email_sent_Category_2                                                                                                                                                                                                                                      
Subject_Hotness_Score                                                                                                                                                                                                                                           
Total_Past_Communications                                                                                                                                                                                                                                       
Word_Count                                                                                                                                                                                                                                                      
Total_Links                                                                                                                                                                                                                                                     
Total_Images                                                                                                                                                                                                                                                    
/ selection=stepwise stb lackfit rsq cl;                                                                                                                                                                                                                        
output out =tmpval3 p=newpred;                                                                                                                                                                                                                                  
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
/*****************************************************cross checking done***********************************************************/                                                                                                                           
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
/**************************performing proc logistic on the var created for Email_status on train dataset*************************************************************/                                                                                          
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
proc logistic data = multilogit descending                                                                                                                                                                                                                      
outest=model_multilogit_1;                                                                                                                                                                                                                                      
model Email_Status_0 =                                                                                                                                                                                                                                          
Email_Type_new                                                                                                                                                                                                                                                  
 Email_Source_Type_new                                                                                                                                                                                                                                          
 Customer_Location_new_1                                                                                                                                                                                                                                        
Customer_Location_new_2                                                                                                                                                                                                                                         
 Customer_Location_new_3                                                                                                                                                                                                                                        
 Customer_Location_new_4                                                                                                                                                                                                                                        
 Customer_Location_new_5                                                                                                                                                                                                                                        
Customer_Location_new_6                                                                                                                                                                                                                                         
Customer_Location_new_7                                                                                                                                                                                                                                         
Email_Campaign_Type_1                                                                                                                                                                                                                                           
Email_Campaign_Type_2                                                                                                                                                                                                                                           
Time_Email_sent_Category_1                                                                                                                                                                                                                                      
Time_Email_sent_Category_2                                                                                                                                                                                                                                      
Subject_Hotness_Score                                                                                                                                                                                                                                           
Total_Past_Communications                                                                                                                                                                                                                                       
Word_Count                                                                                                                                                                                                                                                      
Total_Links                                                                                                                                                                                                                                                     
Total_Images                                                                                                                                                                                                                                                    
/ selection=stepwise stb lackfit rsq cl;                                                                                                                                                                                                                        
output out =tmp_multilogit_1 p=newpred;                                                                                                                                                                                                                         
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
proc logistic data = multilogit descending                                                                                                                                                                                                                      
outest=model_multilogit_2;                                                                                                                                                                                                                                      
model Email_Status_1 =                                                                                                                                                                                                                                          
Email_Type_new                                                                                                                                                                                                                                                  
 Email_Source_Type_new                                                                                                                                                                                                                                          
 Customer_Location_new_1                                                                                                                                                                                                                                        
Customer_Location_new_2                                                                                                                                                                                                                                         
 Customer_Location_new_3                                                                                                                                                                                                                                        
 Customer_Location_new_4                                                                                                                                                                                                                                        
 Customer_Location_new_5                                                                                                                                                                                                                                        
Customer_Location_new_6                                                                                                                                                                                                                                         
Customer_Location_new_7                                                                                                                                                                                                                                         
Email_Campaign_Type_1                                                                                                                                                                                                                                           
Email_Campaign_Type_2                                                                                                                                                                                                                                           
Time_Email_sent_Category_1                                                                                                                                                                                                                                      
Time_Email_sent_Category_2                                                                                                                                                                                                                                      
Subject_Hotness_Score                                                                                                                                                                                                                                           
Total_Past_Communications                                                                                                                                                                                                                                       
Word_Count                                                                                                                                                                                                                                                      
Total_Links                                                                                                                                                                                                                                                     
Total_Images                                                                                                                                                                                                                                                    
/ selection=stepwise stb lackfit rsq cl;                                                                                                                                                                                                                        
output out =tmp_multilogit_2 p=newpred;                                                                                                                                                                                                                         
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
proc logistic data = multilogit descending                                                                                                                                                                                                                      
outest=model_multilogit_3;                                                                                                                                                                                                                                      
model Email_Status_2 =                                                                                                                                                                                                                                          
Email_Type_new                                                                                                                                                                                                                                                  
 Email_Source_Type_new                                                                                                                                                                                                                                          
 Customer_Location_new_1                                                                                                                                                                                                                                        
Customer_Location_new_2                                                                                                                                                                                                                                         
 Customer_Location_new_3                                                                                                                                                                                                                                        
 Customer_Location_new_4                                                                                                                                                                                                                                        
 Customer_Location_new_5                                                                                                                                                                                                                                        
Customer_Location_new_6                                                                                                                                                                                                                                         
Customer_Location_new_7                                                                                                                                                                                                                                         
Email_Campaign_Type_1                                                                                                                                                                                                                                           
Email_Campaign_Type_2                                                                                                                                                                                                                                           
Time_Email_sent_Category_1                                                                                                                                                                                                                                      
Time_Email_sent_Category_2                                                                                                                                                                                                                                      
Subject_Hotness_Score                                                                                                                                                                                                                                           
Total_Past_Communications                                                                                                                                                                                                                                       
Word_Count                                                                                                                                                                                                                                                      
Total_Links                                                                                                                                                                                                                                                     
Total_Images                                                                                                                                                                                                                                                    
/ selection=stepwise stb lackfit rsq cl;                                                                                                                                                                                                                        
output out =tmp_multilogit_3 p=newpred;                                                                                                                                                                                                                         
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
/*                                                                                                                                                                                                                                                              
data tmp_multilogit_1 (keep=newpred Email_ID);                                                                                                                                                                                                                  
set tmp_multilogit_1;                                                                                                                                                                                                                                           
run;*/                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                
data tmp_multilogit_2 (keep=newpred Email_ID);                                                                                                                                                                                                                  
set tmp_multilogit_2;                                                                                                                                                                                                                                           
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
data tmp_multilogit_3 (keep=newpred Email_ID);                                                                                                                                                                                                                  
set tmp_multilogit_3;                                                                                                                                                                                                                                           
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
proc sql;                                                                                                                                                                                                                                                       
create table multilogit_merged as select a.*,b.newpred as newpred_1,c.newpred as newpred_2                                                                                                                                                                      
from tmp_multilogit_1 as a left join tmp_multilogit_2 as b                                                                                                                                                                                                      
on a.Email_ID = b.Email_ID                                                                                                                                                                                                                                      
left join tmp_multilogit_3 as c                                                                                                                                                                                                                                 
on a.Email_ID = c.Email_ID;                                                                                                                                                                                                                                     
quit;                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
data multilogit_merged;                                                                                                                                                                                                                                         
set multilogit_merged;                                                                                                                                                                                                                                          
if newpred > newpred_1 then newpred_compare = newpred; else newpred_compare = newpred_1;                                                                                                                                                                        
if newpred > newpred_1 then newpred_type = 0 ; else newpred_type = 1;                                                                                                                                                                                           
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
data multilogit_merged;                                                                                                                                                                                                                                         
set multilogit_merged;                                                                                                                                                                                                                                          
if newpred_compare > newpred_2 then newpred_compare_fin = newpred_compare; else newpred_compare_fin = newpred_2;                                                                                                                                                
if newpred_compare > newpred_2 then newpred_type_fin = newpred_type ; else newpred_type_fin = 2;                                                                                                                                                                
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
proc freq data=multilogit_merged;                                                                                                                                                                                                                               
tables newpred_type*Email_Status /norow nocol nopercent                                                                                                                                                                                                         
;                                                                                                                                                                                                                                                               
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
data multilogit_merged;                                                                                                                                                                                                                                         
set multilogit_merged;                                                                                                                                                                                                                                          
if newpred_2 > .15 then newpred_type_final = 2 ; else newpred_type_final = newpred_type_fin;                                                                                                                                                                    
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
proc export data=multilogit_merged outfile="\\VBOXSVR\Shared_folder_with_XP_for_SAS\Mckinsey datahack\multilogit_merged.xls"                                                                                                                                    
dbms=excel replace;                                                                                                                                                                                                                                             
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
/**********************************************************predicting future values*******************************************************************/                                                                                                         
                                                                                                                                                                                                                                                                
proc import datafile="\\VBOXSVR\Shared_folder_with_XP_for_SAS\Mckinsey datahack\Test_09JmpYa.csv"                                                                                                                                                               
dbms=csv out=mckinsey.multilogitpred replace;                                                                                                                                                                                                                   
getnames=yes;                                                                                                                                                                                                                                                   
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
data multilogit_pred;                                                                                                                                                                                                                                           
set mckinsey.multilogitpred ;                                                                                                                                                                                                                                   
if Total_Links > 30 then Total_Links = 30;                                                                                                                                                                                                                      
if Total_Images > 20 then Total_Images = 20;                                                                                                                                                                                                                    
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
data multilogit_pred;                                                                                                                                                                                                                                           
set multilogit_pred;                                                                                                                                                                                                                                            
If Customer_Location = "A" then Customer_Location_new = 1 ;                                                                                                                                                                                                     
If Customer_Location = "B" then Customer_Location_new = 2 ;                                                                                                                                                                                                     
If Customer_Location = "C" then Customer_Location_new = 3 ;                                                                                                                                                                                                     
If Customer_Location = "D" then Customer_Location_new = 4 ;                                                                                                                                                                                                     
If Customer_Location = "E" then Customer_Location_new = 5 ;                                                                                                                                                                                                     
If Customer_Location = "F" then Customer_Location_new = 6 ;                                                                                                                                                                                                     
If Customer_Location = "G" then Customer_Location_new = 7 ;                                                                                                                                                                                                     
If Customer_Location = "" then Customer_Location_new = 9 ; /*na considered as other=9*/                                                                                                                                                                         
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
data multilogit_pred;                                                                                                                                                                                                                                           
set multilogit_pred;                                                                                                                                                                                                                                            
If ((Customer_Location_new = 1) & (Total_Past_Communications = .)) then Total_Past_Communications = 29  ;                                                                                                                                                       
If ((Customer_Location_new = 2) & (Total_Past_Communications = .)) then Total_Past_Communications =29   ;                                                                                                                                                       
If ((Customer_Location_new = 3) & (Total_Past_Communications = .)) then Total_Past_Communications =29   ;                                                                                                                                                       
If ((Customer_Location_new = 4) & (Total_Past_Communications = .)) then Total_Past_Communications = 29  ;                                                                                                                                                       
If ((Customer_Location_new = 5) & (Total_Past_Communications = .)) then Total_Past_Communications = 29  ;                                                                                                                                                       
If ((Customer_Location_new = 6) & (Total_Past_Communications = .)) then Total_Past_Communications = 29  ;                                                                                                                                                       
If ((Customer_Location_new = 7) & (Total_Past_Communications = .)) then Total_Past_Communications = 29  ;                                                                                                                                                       
If ((Customer_Location_new = 9) & (Total_Past_Communications = .)) then Total_Past_Communications = 29  ;                                                                                                                                                       
If ((Customer_Location_new = 1) & (Total_Links = .)) then Total_Links = 10  ;                                                                                                                                                                                   
If ((Customer_Location_new = 2) & (Total_Links = .)) then Total_Links = 10  ;                                                                                                                                                                                   
If ((Customer_Location_new = 3) & (Total_Links = .)) then Total_Links = 10  ;                                                                                                                                                                                   
If ((Customer_Location_new = 4) & (Total_Links = .)) then Total_Links = 10  ;                                                                                                                                                                                   
If ((Customer_Location_new = 5) & (Total_Links = .)) then Total_Links = 10  ;                                                                                                                                                                                   
If ((Customer_Location_new = 6) & (Total_Links = .)) then Total_Links = 11  ;                                                                                                                                                                                   
If ((Customer_Location_new = 7) & (Total_Links = .)) then Total_Links = 10  ;                                                                                                                                                                                   
If ((Customer_Location_new = 9) & (Total_Links = .)) then Total_Links = 10  ;                                                                                                                                                                                   
If ((Customer_Location_new = 1) & (Total_Images = .)) then Total_Images = 4  ;                                                                                                                                                                                  
If ((Customer_Location_new = 2) & (Total_Images = .)) then Total_Images = 3  ;                                                                                                                                                                                  
If ((Customer_Location_new = 3) & (Total_Images = .)) then Total_Images = 4  ;                                                                                                                                                                                  
If ((Customer_Location_new = 4) & (Total_Images = .)) then Total_Images = 3 ;                                                                                                                                                                                   
If ((Customer_Location_new = 5) & (Total_Images = .)) then Total_Images = 3  ;                                                                                                                                                                                  
If ((Customer_Location_new = 6) & (Total_Images = .)) then Total_Images = 4  ;                                                                                                                                                                                  
If ((Customer_Location_new = 7) & (Total_Images = .)) then Total_Images = 3  ;                                                                                                                                                                                  
If ((Customer_Location_new = 9) & (Total_Images = .)) then Total_Images = 3  ;                                                                                                                                                                                  
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
data multilogit_pred;                                                                                                                                                                                                                                           
set multilogit_pred;                                                                                                                                                                                                                                            
where Email_Type ne .;                                                                                                                                                                                                                                          
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
data multilogit_pred;                                                                                                                                                                                                                                           
set multilogit_pred;                                                                                                                                                                                                                                            
if Email_Type = 1 then Email_Type_new = 0; else Email_Type_new = 1;                                                                                                                                                                                             
if Email_Source_Type = 1 then Email_Source_Type_new = 0; else Email_Source_Type_new = 1;                                                                                                                                                                        
if Customer_Location_new = 1 then Customer_Location_new_1 = 1; else Customer_Location_new_1 = 0;                                                                                                                                                                
if Customer_Location_new = 2 then Customer_Location_new_2 = 1; else Customer_Location_new_2 = 0;                                                                                                                                                                
if Customer_Location_new = 3 then Customer_Location_new_3 = 1; else Customer_Location_new_3 = 0;                                                                                                                                                                
if Customer_Location_new = 4 then Customer_Location_new_4 = 1; else Customer_Location_new_4 = 0;                                                                                                                                                                
if Customer_Location_new = 5 then Customer_Location_new_5 = 1; else Customer_Location_new_5 = 0;                                                                                                                                                                
if Customer_Location_new = 6 then Customer_Location_new_6 = 1; else Customer_Location_new_6 = 0;                                                                                                                                                                
if Customer_Location_new = 7 then Customer_Location_new_7 = 1; else Customer_Location_new_7 = 0;                                                                                                                                                                
if Email_Campaign_Type = 1 then Email_Campaign_Type_1 = 1; else Email_Campaign_Type_1 = 0;                                                                                                                                                                      
if Email_Campaign_Type = 2 then Email_Campaign_Type_2 = 1; else Email_Campaign_Type_2 = 0;                                                                                                                                                                      
if Time_Email_sent_Category = 1 then Time_Email_sent_Category_1 = 1; else Time_Email_sent_Category_1 = 0;                                                                                                                                                       
if Time_Email_sent_Category = 2 then Time_Email_sent_Category_2 = 1; else Time_Email_sent_Category_2 = 0;                                                                                                                                                       
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
data multilogit_pred;                                                                                                                                                                                                                                           
set multilogit_pred;                                                                                                                                                                                                                                            
if Email_Status = 0 then Email_Status_0 = 1; else Email_Status_0 = 0;                                                                                                                                                                                           
if Email_Status = 1 then Email_Status_1 = 1; else Email_Status_1 = 0;                                                                                                                                                                                           
if Email_Status = 2 then Email_Status_2 = 1; else Email_Status_2 = 0;                                                                                                                                                                                           
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
data multilogit_pred;                                                                                                                                                                                                                                           
set multilogit_pred;                                                                                                                                                                                                                                            
Odds_ratio1=EXP(((Email_Type_new*0.4937955107)+(Email_Source_Type_new*0.1239042705)+(Email_Campaign_Type_1*-4.584677196)                                                                                                                                        
+(Email_Campaign_Type_2*1.6313313561)+(Subject_Hotness_Score*-0.369976762)+(Total_Past_Communications*-0.049661057)+(Word_Count*0.0010803552))+1.466840498);                                                                                                    
Prob1=(Odds_ratio1/(1+Odds_ratio1));                                                                                                                                                                                                                            
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
data multilogit_pred;                                                                                                                                                                                                                                           
set multilogit_pred;                                                                                                                                                                                                                                            
Odds_ratio2=EXP(((Email_Type_new*-0.425475659)+(Email_Campaign_Type_1*3.1305896832)+(Email_Campaign_Type_2*-1.408727327)                                                                                                                                        
+(Subject_Hotness_Score*0.3775781873)+(Total_Past_Communications*0.0429500308)+(Word_Count*-0.001064576)+(Total_Links*-0.009528115))-1.62654044);                                                                                                               
Prob2=(Odds_ratio2/(1+Odds_ratio2));                                                                                                                                                                                                                            
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
data multilogit_pred;                                                                                                                                                                                                                                           
set multilogit_pred;                                                                                                                                                                                                                                            
Odds_ratio3=EXP(((Email_Type_new*-0.321005211)+(Email_Source_Type_new*-0.279288476)+(Email_Campaign_Type_1*3.0072938961)                                                                                                                                        
+(Email_Campaign_Type_2*-1.42439512)+(Total_Past_Communications*0.0417644816)+(Word_Count*-0.000431996)+(Total_Links*0.0307300477))-3.864736818);                                                                                                               
Prob3=(Odds_ratio3/(1+Odds_ratio3));                                                                                                                                                                                                                            
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
data multilogit_pred;                                                                                                                                                                                                                                           
set multilogit_pred;                                                                                                                                                                                                                                            
if Prob1 > Prob2 then Prob_compare = Prob1; else Prob_compare = Prob2;                                                                                                                                                                                          
if Prob1 > Prob2 then Prob_type = 0 ; else Prob_type = 1;                                                                                                                                                                                                       
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
data multilogit_pred;                                                                                                                                                                                                                                           
set multilogit_pred;                                                                                                                                                                                                                                            
if Prob_compare > Prob3 then Prob_compare_fin = Prob_compare; else Prob_compare_fin = Prob3;                                                                                                                                                                    
if Prob_compare > Prob3 then Prob_type_fin = Prob_type ; else Prob_type_fin = 2;                                                                                                                                                                                
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
proc export data=multilogit_pred                                                                                                                                                                                                                                
outfile="\\VBOXSVR\Shared_folder_with_XP_for_SAS\Mckinsey datahack\multilogit_pred.xls"                                                                                                                                                                         
dbms=excel replace;                                                                                                                                                                                                                                             
run;                                                                                                                                                                                                                                                            
/**********************************************************End of hiring hack**********************************************/                                                        
